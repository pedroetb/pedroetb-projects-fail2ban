include:
  - project: 'pedroetb-projects/gitlab-ci-templates'
    ref: master
    file: '/deployment-service/lulu/docker-deploy.yml'
  - project: 'pedroetb-projects/gitlab-ci-templates'
    ref: master
    file: '/deployment-service/oracle/docker-deploy.yml'
  - project: 'pedroetb-projects/gitlab-ci-templates'
    ref: master
    file: '/deployment-service/museo/docker-deploy.yml'

stages:
  - deploy

.deploy:
  variables:
    FORCE_DOCKER_COMPOSE: 1
    OMIT_CLEAN_DEPLOY: 1
    COMPOSE_FILE: compose.common.yaml:compose.input.yaml:compose.docker.yaml
    SERVICES_TO_CHECK: fail2ban-input fail2ban-docker
  environment:
    name: node1

.deploy-secondary-node:
  variables: &deploy-secondary-node-variables
    COMPOSE_FILE: compose.common.yaml:compose.input.yaml
    SERVICES_TO_DEPLOY: fail2ban-input
    SERVICES_TO_CHECK: fail2ban-input

.deploy-node2:
  environment: &deploy-node2-environment
    name: node2

.deploy-node3:
  environment: &deploy-node3-environment
    name: node3

deploy-node2-branch:
  extends: deploy-branch
  variables: *deploy-secondary-node-variables
  environment: *deploy-node2-environment

deploy-node2-tag:
  extends: deploy-tag
  variables: *deploy-secondary-node-variables
  environment: *deploy-node2-environment

deploy-node3-branch:
  extends: deploy-branch
  variables: *deploy-secondary-node-variables
  environment: *deploy-node3-environment

deploy-node3-tag:
  extends: deploy-tag
  variables: *deploy-secondary-node-variables
  environment: *deploy-node3-environment
